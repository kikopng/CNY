<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 CNY Goodies | Premium Cookies & Bakkwa</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* --- COPYING SAME STYLING AS BEFORE FOR CONSISTENCY --- */
        :root { --cny-red: #c41e3a; --cny-dark-red: #8a0b1e; --cny-gold: #d4af37; --bg-cream: #fffdf5; --text-dark: #3e0c13; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg-cream); color: var(--text-dark); margin: 0; padding-bottom: 120px; background-image: radial-gradient(rgba(212, 175, 55, 0.2) 1px, transparent 1px); background-size: 30px 30px; }
        
        /* Header & Nav */
        header { background: linear-gradient(135deg, #2b050a, var(--cny-dark-red)); color: var(--cny-gold); text-align: center; padding: 40px 20px 20px; border-bottom: 4px solid var(--cny-gold); }
        h1 { margin: 0; font-size: 2.2rem; }
        .category-nav { position: sticky; top: 0; background: rgba(255,255,255,0.95); padding: 15px 0; z-index: 100; display: flex; justify-content: center; gap: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .nav-btn { padding: 8px 18px; border-radius: 20px; text-decoration: none; color: var(--cny-dark-red); font-weight: bold; border: 1px solid transparent; transition: 0.3s; }
        .nav-btn:hover { background: #fff5f5; border-color: var(--cny-red); }

        /* Container & Cards */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .category-header { text-align: center; margin: 40px 0 20px; color: var(--cny-dark-red); font-size: 1.8rem; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 20px; }
        
        .card { background: white; border-radius: 15px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: flex; flex-direction: column; justify-content: space-between; border: 1px solid transparent; transition: transform 0.2s; }
        .card:hover { transform: translateY(-3px); border-color: var(--cny-gold); }
        .card.in-cart { border: 2px solid var(--cny-red); background: #fff9f9; }
        
        .price-tag { background: var(--cny-red); color: white; padding: 4px 10px; border-radius: 10px; font-weight: bold; float: right; font-size: 0.9rem; }
        .product-name { font-weight: bold; font-size: 1.1rem; margin-bottom: 5px; }
        .add-btn { background: white; color: var(--cny-red); border: 2px solid var(--cny-red); width: 100%; padding: 8px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .add-btn:hover { background: var(--cny-red); color: white; }
        .qty-control { display: none; align-items: center; justify-content: center; gap: 10px; margin-top: 5px; }
        .card.in-cart .add-btn { display: none; }
        .card.in-cart .qty-control { display: flex; }
        .qty-btn { background: var(--cny-red); color: white; border: none; width: 30px; height: 30px; border-radius: 5px; font-weight: bold; cursor: pointer; }

        /* Hamper */
        .hamper-box { background: linear-gradient(135deg, #3e0c13, #1a0305); color: var(--cny-gold); padding: 30px; border-radius: 15px; text-align: center; margin-top: 40px; }
        .hamper-btn { display: inline-block; background: transparent; border: 2px solid var(--cny-gold); color: var(--cny-gold); padding: 10px 25px; border-radius: 25px; text-decoration: none; margin-top: 15px; font-weight: bold; }

        /* Cart & Modal */
        .cart-bar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 500px; background: white; padding: 15px 25px; border-radius: 50px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); display: none; justify-content: space-between; align-items: center; z-index: 900; border: 2px solid var(--cny-red); }
        .checkout-btn { background: var(--cny-red); color: white; border: none; padding: 10px 20px; border-radius: 25px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: white; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto; border-radius: 15px; padding: 25px; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from {transform: translateY(50px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }
        
        .form-group { margin-bottom: 15px; }
        .form-input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .btn-whatsapp { background: #25D366; color: white; width: 100%; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 10px; font-size: 1rem; }
        .btn-submit { background: #3e0c13; color: var(--cny-gold); width: 100%; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem; display: flex; justify-content: center; align-items: center; gap: 10px; }
        
        .divider { display: flex; align-items: center; text-align: center; color: #888; margin: 20px 0; font-size: 0.8rem; }
        .divider::before, .divider::after { content: ''; flex: 1; border-bottom: 1px solid #ddd; }
        .divider::before { margin-right: 10px; }
        .divider::after { margin-left: 10px; }

        .helper-text { font-size: 0.75rem; color: #666; margin-top: 4px; }
        .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 10px 20px; border-radius: 20px; opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 2000; }
        .toast.show { opacity: 1; }
        
        /* Spinner */
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid var(--cny-gold); border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<header>
    <div style="position: absolute; top: 20px; right: 20px; cursor: pointer;" onclick="openCheckout()">
        <i class="fas fa-shopping-cart" style="font-size: 1.5rem;"></i>
        <span id="headerCount" style="background:red; color:white; border-radius:50%; padding: 2px 6px; font-size: 0.7rem; vertical-align: top;">0</span>
    </div>
    <h1>2026 CNY Shop</h1>
    <div style="font-size: 0.9rem; opacity: 0.9; margin-top:5px;">Homemade Goodies & Hampers</div>
</header>

<nav class="category-nav">
    <a href="#section-biscuits" class="nav-btn">üç™ Biscuits</a>
    <a href="#section-meat" class="nav-btn">ü•© Dried Meat</a>
    <a href="#section-hampers" class="nav-btn">üéÅ Hampers</a>
</nav>

<div class="container">
    
    <!-- Biscuits -->
    <div id="section-biscuits">
        <div class="category-header">CNY Cookies</div>
        <div style="text-align:center; margin-bottom: 20px; color: var(--cny-red); font-weight: bold;">
            ‚ú® PROMO: Mix & Match any 3 for RM 52! (RM18 items)
        </div>
        <div class="product-grid" id="grid-18"></div>
        
        <h3 style="text-align:center; margin-top:40px; color:var(--cny-dark-red);">Premium Selection (RM 22)</h3>
        <div class="product-grid" id="grid-22"></div>
        
        <h3 style="text-align:center; margin-top:40px; color:var(--cny-dark-red);">Signature Series</h3>
        <div class="product-grid" id="grid-signature"></div>
    </div>

    <!-- Meat -->
    <div id="section-meat">
        <div class="category-header">Charcoal Grilled Bakkwa</div>
        <div class="product-grid" id="grid-meat"></div>
    </div>

    <!-- Hampers -->
    <div id="section-hampers" class="hamper-box">
        <i class="fas fa-gift" style="font-size: 3rem; margin-bottom: 15px;"></i>
        <h2>CNY Hampers</h2>
        <p>Customizable hampers for corporate & family gifting.</p>
        <a href="#" onclick="inquireHamper()" class="hamper-btn">Ask via WhatsApp</a>
    </div>

</div>

<!-- Cart Bar -->
<div class="cart-bar" id="cartBar">
    <div style="display:flex; flex-direction:column;">
        <span style="font-weight:bold;">Total: RM <span id="totalPrice">0</span></span>
        <span style="font-size:0.8rem; color:#666;"><span id="totalItems">0</span> items</span>
    </div>
    <button class="checkout-btn" onclick="openCheckout()">Checkout <i class="fas fa-arrow-right"></i></button>
</div>

<!-- Modal -->
<div class="modal-overlay" id="checkoutModal">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 style="margin:0; color:var(--cny-dark-red);">Review Order</h2>
            <button onclick="closeCheckout()" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button>
        </div>

        <div id="orderSummaryList" style="background:#f9f9f9; padding:15px; border-radius:10px; margin-bottom:20px; font-size:0.9rem;"></div>

        <div class="form-group">
            <label style="font-weight:bold; display:block; margin-bottom:5px;">Name</label>
            <input type="text" id="custName" class="form-input" placeholder="Your Name">
            <div class="helper-text">*Optional for WhatsApp</div>
        </div>
        <div class="form-group">
            <label style="font-weight:bold; display:block; margin-bottom:5px;">Phone</label>
            <input type="tel" id="custPhone" class="form-input" placeholder="012-3456789">
            <div class="helper-text">*Optional for WhatsApp</div>
        </div>
        <div class="form-group">
            <label style="font-weight:bold; display:block; margin-bottom:5px;">Remarks</label>
            <input type="text" id="custRemarks" class="form-input" placeholder="Any special requests?">
        </div>

        <!-- Buttons -->
        <button class="btn-whatsapp" onclick="sendWhatsApp()">
            <i class="fab fa-whatsapp"></i> Send via WhatsApp
        </button>
        
        <div class="divider">OR</div>
        
        <button class="btn-submit" onclick="submitToSheet()" id="sheetBtn">
            <div class="spinner" id="loadingSpinner"></div>
            <span id="sheetBtnText"><i class="fas fa-cloud-upload-alt"></i> Submit Order to Shop</span>
        </button>
        <div style="text-align:center; font-size:0.75rem; color:#888; margin-top:5px;">(Requires Name & Phone)</div>
    </div>
</div>

<div class="toast" id="toast">Item added!</div>

<script>
    // --- CONFIGURATION ---
    const PHONE_NUMBER = "60199881373"; 
    
    // *** PASTE YOUR GOOGLE WEB APP URL HERE ***
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw1nGrORIGWuFr7_LlzLrvfhOXwNopqi9pOS6aLEGk5sOmlkPRYAezOAdkB8y9D_JiT/exec"; 

    // --- PRODUCT DATA ---
    const products = [
        { id: 101, name: "Fried Ngaku (ÁÇ∏ËäΩËèá)", price: 18, cat: "hot" },
        { id: 102, name: "Hae Bee Hiam Rolls", weight: "270g", price: 18, cat: "hot" },
        { id: 103, name: "Chicken Floss Rolls", weight: "200g", price: 18, cat: "hot" },
        { id: 104, name: "Fried Seaweed", weight: "125g", price: 18, cat: "hot" },
        { id: 105, name: "Fried Crab Stick", weight: "150g", price: 18, cat: "hot" },
        { id: 106, name: "Snowflake Flakes", weight: "300g", price: 18, cat: "hot" },
        { id: 107, name: "Sweet Potato Chips", weight: "160g", price: 18, cat: "hot" },
        { id: 108, name: "Pumpkin Crackers", weight: "160g", price: 18, cat: "hot" },
        { id: 109, name: "Tofu Crackers", weight: "150g", price: 18, cat: "hot" },
        { id: 110, name: "Seaweed Sticks", weight: "240g", price: 18, cat: "hot" },
        { id: 111, name: "Egg Cookies", weight: "360g", price: 18, cat: "hot" },
        { id: 112, name: "5-Spice Bean", weight: "280g", price: 18, cat: "hot" },
        { id: 113, name: "Strawberry Egg Rolls", weight: "300g", price: 18, cat: "hot" },
        { id: 114, name: "Chocolate Egg Rolls", weight: "300g", price: 18, cat: "hot" },
        { id: 115, name: "Peanut Puffs", weight: "450g", price: 18, cat: "hot" },
        { id: 116, name: "Kuih Bangkit", weight: "400g", price: 18, cat: "hot" },
        { id: 117, name: "Meat Floss Kapit", price: 18, cat: "hot" },
        
        { id: 201, name: "Pineapple Rolls", weight: "400g", price: 22, cat: "prem" },
        { id: 202, name: "Pineapple Balls", weight: "300g", price: 22, cat: "prem" },
        { id: 203, name: "Yam Cookies", weight: "230g", price: 22, cat: "prem" },
        { id: 204, name: "Salted Egg Fish Skin", weight: "130g", price: 22, cat: "prem" },
        { id: 205, name: "Almond Cookies", weight: "350g", price: 22, cat: "prem" },
        { id: 206, name: "Peanut Cookies", weight: "400g", price: 22, cat: "prem" },
        { id: 207, name: "Dragon Cookies", price: 22, cat: "prem" },
        { id: 208, name: "Coconut Bangkit", weight: "220g", price: 22, cat: "prem" },
        { id: 209, name: "Kuih Kapit Trad", weight: "400g", price: 22, cat: "prem" },
        { id: 210, name: "Peanut Butter Kapit", price: 22, cat: "prem" },

        { id: 301, name: "Premium Kuih Kapit", price: 25, cat: "sig" },
        { id: 302, name: "Mixed Sauce Kapit", price: 28, cat: "sig" },
        { id: 303, name: "Peanut Nyonya Kapit", price: 28, cat: "sig" },
        { id: 304, name: "Honey Mixed Nuts", price: 28, cat: "sig" },

        { id: 401, name: "Minced Pork BBQ", weight: "500g", price: 50, cat: "meat" },
        { id: 402, name: "Honey Sliced Pork", weight: "500g", price: 60, cat: "meat" },
        { id: 403, name: "Minced Chicken BBQ", weight: "500g", price: 51, cat: "meat" },
        { id: 404, name: "Mini Honey Pork", weight: "400g", price: 50, cat: "meat" },
        { id: 405, name: "Chicken Floss", weight: "250g", price: 23, cat: "meat" }
    ];

    let cart = {};

    function renderAll() {
        const render = (id, list) => {
            const el = document.getElementById(id);
            if(el) el.innerHTML = list.map(p => `
                <div class="card" id="card-${p.id}">
                    <div>
                        <div class="price-tag">RM ${p.price}</div>
                        <div class="product-name">${p.name}</div>
                        <div style="font-size:0.8rem; color:#888;">${p.weight || ''}</div>
                    </div>
                    <div style="margin-top:15px;">
                        <button class="add-btn" onclick="updateCart(${p.id}, 1)">ADD</button>
                        <div class="qty-control">
                            <button class="qty-btn" onclick="updateCart(${p.id}, -1)">-</button>
                            <span style="font-weight:bold" id="qty-${p.id}">0</span>
                            <button class="qty-btn" onclick="updateCart(${p.id}, 1)">+</button>
                        </div>
                    </div>
                </div>
            `).join('');
        };
        render('grid-18', products.filter(p => p.cat === 'hot'));
        render('grid-22', products.filter(p => p.cat === 'prem'));
        render('grid-signature', products.filter(p => p.cat === 'sig'));
        render('grid-meat', products.filter(p => p.cat === 'meat'));
    }

    function updateCart(id, change) {
        if (!cart[id]) cart[id] = 0;
        cart[id] += change;
        if (cart[id] <= 0) {
            delete cart[id];
            document.getElementById(`card-${id}`).classList.remove('in-cart');
        } else {
            document.getElementById(`card-${id}`).classList.add('in-cart');
            document.getElementById(`qty-${id}`).innerText = cart[id];
            if(change > 0) showToast();
        }
        recalcTotal();
    }

    function recalcTotal() {
        let total = 0, count = 0, hotCount = 0;
        for (const [id, qty] of Object.entries(cart)) {
            const p = products.find(x => x.id == id);
            count += qty;
            if (p.cat === 'hot') hotCount += qty;
            else total += (p.price * qty);
        }
        total += (Math.floor(hotCount/3) * 52) + ((hotCount%3) * 18);
        document.getElementById('totalPrice').innerText = total;
        document.getElementById('totalItems').innerText = count;
        document.getElementById('headerCount').innerText = count;
        document.getElementById('cartBar').style.display = count > 0 ? "flex" : "none";
    }

    function showToast() {
        const t = document.getElementById('toast');
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 2000);
    }

    function openCheckout() {
        if (Object.keys(cart).length === 0) return alert("Cart is empty");
        let html = '', total = document.getElementById('totalPrice').innerText;
        for (const [id, qty] of Object.entries(cart)) {
            const p = products.find(x => x.id == id);
            html += `<div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>${p.name} x${qty}</span><span>RM ${p.price*qty}</span></div>`;
        }
        html += `<div style="border-top:1px solid #ccc; margin-top:10px; padding-top:5px; font-weight:bold; display:flex; justify-content:space-between;"><span>Total</span><span>RM ${total}</span></div>`;
        document.getElementById('orderSummaryList').innerHTML = html;
        document.getElementById('checkoutModal').style.display = 'flex';
    }

    function closeCheckout() { document.getElementById('checkoutModal').style.display = 'none'; }
    function inquireHamper() { window.open(`https://wa.me/${PHONE_NUMBER}?text=Hi, I am interested in Hampers.`, '_blank'); }

    // --- SUBMISSION LOGIC ---

    function getOrderDetails() {
        let lines = [];
        for (const [id, qty] of Object.entries(cart)) {
            const p = products.find(x => x.id == id);
            lines.push(`${p.name} (x${qty})`);
        }
        return lines.join(", ");
    }

    function sendWhatsApp() {
        const name = document.getElementById('custName').value || "New Customer";
        const phone = document.getElementById('custPhone').value || "";
        const remarks = document.getElementById('custRemarks').value;
        const total = document.getElementById('totalPrice').innerText;
        
        let msg = `*üßß CNY ORDER 2026*\n\n*Name:* ${name}\n*Phone:* ${phone}\n*Note:* ${remarks}\n\n*--- ORDER ---*\n`;
        for (const [id, qty] of Object.entries(cart)) {
            const p = products.find(x => x.id == id);
            msg += `‚ñ™Ô∏è ${p.name} x${qty}\n`;
        }
        msg += `\nüí∞ *Total: RM ${total}*`;
        window.open(`https://wa.me/${PHONE_NUMBER}?text=${encodeURIComponent(msg)}`, '_blank');
        closeCheckout();
    }

    function submitToSheet() {
        const name = document.getElementById('custName').value.trim();
        const phone = document.getElementById('custPhone').value.trim();
        const remarks = document.getElementById('custRemarks').value.trim();
        const total = document.getElementById('totalPrice').innerText;

        if (!name || !phone) return alert("Please enter Name and Phone to submit to our system.");
        if (GOOGLE_SCRIPT_URL.includes("EXAMPLE")) return alert("Error: Shop owner has not set up the script URL yet.");

        const btn = document.getElementById('sheetBtn');
        const spinner = document.getElementById('loadingSpinner');
        const btnText = document.getElementById('sheetBtnText');
        
        // Loading State
        btn.disabled = true;
        spinner.style.display = 'block';
        btnText.innerText = "Processing...";

        const payload = {
            name: name,
            phone: phone,
            order: getOrderDetails(),
            total: total,
            remarks: remarks
        };

        fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors', // Important for Google Apps Script
            headers: {
                'Content-Type': 'text/plain' // Helps avoid pre-flight CORS check
            },
            body: JSON.stringify(payload)
        }).then(() => {
            alert("Order Submitted! We will contact you shortly.");
            cart = {};
            recalcTotal();
            closeCheckout();
            
            // Reset Button
            btn.disabled = false;
            spinner.style.display = 'none';
            btnText.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Submit Order to Shop';
        }).catch(err => {
            console.error(err);
            alert("Error submitting order. Please try WhatsApp.");
            btn.disabled = false;
            spinner.style.display = 'none';
            btnText.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Submit Order to Shop';
        });
    }

    document.addEventListener('DOMContentLoaded', renderAll);
</script>
</body>
</html>
